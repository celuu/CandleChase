!function(){"use strict";!function(){class t{constructor(t,e){this.row=t,this.col=e}}class e{constructor(t,e){this.isLit=!1,this.x=t,this.y=e,this.width=50,this.height=50}}class i{constructor(t,e){this.candleCanvas=t,this.screenCanvas=e,this.candleCtx=t.getContext("2d"),this.screenCtx=e.getContext("2d"),this.dimensions={width:e.width,height:e.height},this.grid=this.makeEmptyGrid(),this.candles=this.generateCandles(),this.allCandlesLit=!1,this.width=100,this.height=100,this.candleWidth=50,this.candleHeight=50,this.x=350,this.y=0,this.speed=0,this.maxSpeed=5,this.spriteWidth=128,this.spriteHeight=128,this.frame=1,this.timer=0}update(t,e){if(e.includes("Space")){let e=!0;for(let i=0;i<this.candles.length;i++){let s=this.candles[i],h=t.x-s.x,n=t.y-s.y;Math.sqrt(h*h+n*n)<100&&(s.isLit=!0),e=e&&s.isLit}this.allCandlesLit=e}}draw(t){this.drawAllCandles(),this.drawInitialScreen(),this.removeScreen(t.x+70,t.y+50,40),this.removeScreen(500,120,60),this.removeScreenForTimer(20,40,225,45);for(let t=0;t<this.candles.length;t++){let e=this.candles[t];e.isLit&&this.removeScreen(e.x+25,e.y+10,30)}}removeScreenForTimer(t,e,i,s){this.screenCtx.fillStyle="#FFFFFF",this.screenCtx.fillRect(t,e,i,s),this.screenCtx.fill(),this.screenCtx.globalCompositeOperation="destination-out",this.screenCtx.shadowBlur=30,this.screenCtx.shadowColor="white",this.screenCtx.lineWidth=5,this.screenCtx.stroke()}drawInitialScreen(){this.screenCtx.globalCompositeOperation="source-over",this.screenCtx.fillStyle="black",this.screenCtx.fillRect(0,0,this.dimensions.width,this.dimensions.height)}removeScreen(t,e,i){this.screenCtx.globalCompositeOperation="destination-out",this.screenCtx.shadowBlur=30,this.screenCtx.shadowColor="white";for(let s=0;s<5;s++)this.screenCtx.beginPath(),this.screenCtx.arc(t,e,i,0,2*Math.PI,!1),this.screenCtx.fill(),this.screenCtx.lineWidth=5,this.screenCtx.stroke()}makeEmptyGrid(){let t=[];for(let e=0;e<10;e++){t.push([]);for(let i=0;i<15;i++)t[e].push(null)}return t}isValidPos(t){return!(t.row<0||t.row>=10||t.col<0||t.col>=15)}isEmpty(t){return null===this.grid[t.row][t.col]}isAvailableForPlacement(e){if(!this.isValidPos(e))return!1;for(let i=-1;i<2;i++)for(let s=-1;s<2;s++){let h=new t(e.row+i,e.col+s);if(!this.isValidPos(h)||!this.isEmpty(h))return!1}return!0}generateCandles(){let i=0,s=0,h=[];for(;i<10&&s<100;){s+=1;let n=Math.floor(10*Math.random()),r=Math.floor(15*Math.random());const a=new t(n,r);if(this.isAvailableForPlacement(a)){this.grid[a.row][a.col]="X";let t=this.calculateXY(a);i++;const s=-10+Math.floor(20*Math.random()),n=-10+Math.floor(20*Math.random()),r=new e(t.x+s,t.y+n);h.push(r)}}return s>=100&&console.error("gave up"),h}calculateXY(t){let e=t.row,i=t.col,s={};const h=this.dimensions.height-150;let n=(this.dimensions.width-10-10)*(i/15)+10;s.x=n;let r=h*(e/10)+150;return s.y=r,s}drawAllCandles(){if(this.candleImage){for(let t=0;t<this.candles.length;t++){let e=this.candles[t];if(e.isLit){let t=new Image;t.src="./assets/lit-candles.png",this.candleCtx.drawImage(t,e.x,e.y,this.candleWidth,this.candleHeight)}this.candleCtx.drawImage(this.candleImage,e.x,e.y,this.candleWidth,this.candleHeight)}return}let t=new Image;t.src="./assets/candles.png",t.onload=()=>{this.candleImage=t}}}class s{constructor(){this.keys=[],window.addEventListener("keydown",(t=>{"ArrowDown"!==t.code&&"ArrowUp"!==t.code&&"ArrowLeft"!==t.code&&"ArrowRight"!==t.code&&"Space"!==t.code||-1!==this.keys.indexOf(t.code)||this.keys.push(t.code),t.preventDefault()})),window.addEventListener("keyup",(t=>{"ArrowDown"!==t.code&&"ArrowUp"!==t.code&&"ArrowLeft"!==t.code&&"ArrowRight"!==t.code&&"Space"!==t.code||this.keys.splice(this.keys.indexOf(t.code),1),t.preventDefault()}))}}class h{constructor(t){this.game=t,this.width=100,this.height=100,this.x=450,this.y=120,this.desiredX=350,this.desiredY=0,this.maxSpeed=5,this.xVelocity=0,this.yVelocity=0,this.spriteWidth=129,this.spriteHeight=128,this.frame=1,this.timer=0,this.lastMovingLeft=!1,this.lastMovingUp=!1}update(t,e){if(e)return;let i=0,s=0;t.includes("ArrowRight")?(this.lastMovingLeft=!1,this.xVelocity=Math.min(1,this.xVelocity+.05),i=this.maxSpeed*this.xVelocity):t.includes("ArrowLeft")?(this.lastMovingLeft=!0,this.xVelocity=Math.min(1,this.xVelocity+.05),i=-this.maxSpeed*this.xVelocity):(this.xVelocity=Math.max(0,this.xVelocity-.1),i=this.maxSpeed*this.xVelocity,this.lastMovingLeft&&(i*=-1)),t.includes("ArrowUp")?(this.lastMovingUp=!0,this.yVelocity=Math.min(1,this.yVelocity+.05),s=-this.maxSpeed*this.yVelocity):t.includes("ArrowDown")?(this.lastMovingUp=!1,this.yVelocity=Math.min(1,this.yVelocity+.05),s=this.maxSpeed*this.yVelocity):(this.yVelocity=Math.max(0,this.yVelocity-.1),s=this.maxSpeed*this.yVelocity,this.lastMovingUp&&(s*=-1)),0==this.xVelocity&&0==this.yVelocity||(this.timer++,this.timer%5==0&&(this.frame>6?this.frame=0:this.frame++)),this.desiredX=this.x+i,this.desiredY=this.y+s,this.desiredX<=0&&(this.desiredX=this.x),this.desiredX>=this.game.dimensions.width-this.width&&(this.desiredX=this.x),this.desiredY<=100&&(this.desiredY=this.y),this.desiredY>=this.game.dimensions.height-this.height&&(this.desiredY=this.y)}draw(t){let e=new Image;e.src="./assets/spritesheet.png",t.drawImage(e,this.frame*this.spriteWidth,2.03*this.spriteHeight,this.spriteWidth,this.spriteHeight,this.x,this.y,this.width,this.height)}}class n{constructor(t){this.game=t,this.width=75,this.height=75,this.x=0,this.y=0,this.speed=0,this.maxSpeed=5,this.spriteWidth=16,this.spriteHeight=24,this.numOfEnemies=5,this.speed=1,this.frame=0,this.timer=0}update(){this.x+=this.speed,this.y+=this.speed,this.timer++,this.timer%3==0&&(this.frame>4?this.frame=0:this.frame++)}draw(t){let e=new Image;e.src="./assets/Bat_Sprite_Sheet.png",t.drawImage(e,this.frame*this.spriteWidth,this.spriteHeight,this.spriteWidth,this.spriteHeight,this.x,this.y,this.width,this.height)}}class r{constructor(t,e){this.candleCanvas=t,this.screenCanvas=e,this.candleCtx=t.getContext("2d"),this.screenCtx=e.getContext("2d"),this.score=0,this.secondsRemaining=20,this.winningScore=100,this.dimensions={width:t.width,height:t.height},this.board=new i(t,e),this.player=new h(this),this.input=new s,this.enemy=new n(this),this.timer=0,this.collidedTimer=0,this.dyingFrame=0,this.spriteWidth=129,this.spriteHeight=128,this.startTimer(),this.collided=!1,this.lightning=0,this.startLightningLoop(),this.isOver=!1,this.lightningLoopTimer=0,this.music=document.createElement("audio"),this.music.src="./assets/background_audio.mp3",this.music.volume=.1,this.music.play(),this.userWon=!1,this.audioElement=document.getElementById("audio"),this.isDying=!1}update(){if(this.isOver)return;this.enemy.update();let t=this.collided;this.detectEnemyCollisions(),!1===t&&!0===this.collided&&!1===this.isDying&&(this.isDying=!0),this.player.update(this.input.keys,this.isDying),this.drawCharacter(),this.board.update(this.player,this.input.keys,this.candleCtx),this.checkGameStatus()}draw(){if(this.candleCtx.clearRect(0,0,this.dimensions.width,this.dimensions.height),this.screenCtx.clearRect(0,0,this.dimensions.width,this.dimensions.height),this.board.draw(this.player),this.isDying){let t=new Image;t.src="./assets/spritesheet.png",this.candleCtx.drawImage(t,Math.min(this.dyingFrame,9)*this.spriteWidth,this.spriteHeight,this.spriteWidth,this.spriteHeight,this.player.x,this.player.y,this.player.width,this.player.height),this.dyingFrame<200?this.dyingFrame++:(this.isDying=!1,this.dyingFrame=0)}else this.player.draw(this.candleCtx);this.enemy.draw(this.candleCtx),this.drawTimer()}startTimer(){this.timer=setInterval(this.decrementSecondsRemaining.bind(this),1e3)}decrementSecondsRemaining(){this.secondsRemaining--,this.secondsRemaining<=0&&this.gameOver()}startLightningLoop(){this.lightningLoopTimer=setInterval(this.runLightningAnimations.bind(this),8e3)}runLightningAnimations(){this.startLightning(),setTimeout(this.stopLightning,3e3)}startLightning(){document.getElementsByClassName("background")[0].classList.add("lightningAnimationForBackground"),document.getElementById("screen-canvas").classList.add("lightningAnimationForScreen"),this.audioElement.play()}stopLightning(){document.getElementsByClassName("background")[0].classList.remove("lightningAnimationForBackground"),document.getElementById("screen-canvas").classList.remove("lightningAnimationForScreen")}checkGameStatus(){this.secondsRemaining<=0&&0==this.board.allCandlesLit&&this.gameOver(),1==this.board.allCandlesLit&&this.secondsRemaining>0&&this.gameWon()}gameWon(){this.audioElement.pause(),clearInterval(this.timer),clearInterval(this.lightningLoopTimer),this.isOver=!0,document.getElementById("winner_screen").classList.remove("hidden")}gameOver(){this.audioElement.pause(),clearInterval(this.timer),clearInterval(this.lightningLoopTimer),this.isOver=!0,document.getElementById("end_game_screen").classList.remove("hidden")}detectEnemyCollisions(){let t=this.enemy.x,e=this.enemy.y,i=this.player.x,s=this.player.y;this.isColliding(i,s,this.player.width,this.player.height,t,e,this.enemy.width,this.enemy.height)}drawTimer(){this.candleCtx.font="40px Nerko One",this.candleCtx.fillStyle="#FFFFFF",this.candleCtx.fillText(`Time Left: ${this.secondsRemaining} `,20,75)}isColliding(t,e,i,s,h,n,r,a){this.collided=!(t>h+r||t+i<h||e>n+a||e+s<n)}drawCharacter(){this.player.x=this.player.desiredX,this.player.y=this.player.desiredY}}const a=document.getElementById("candle-canvas"),d=document.getElementById("screen-canvas");let l=null;window.addEventListener("keydown",(t=>{"Space"===t.code&&(l?l.isOver&&(l=new r(a,d),document.getElementById("end_game_screen").classList.add("hidden"),document.getElementById("winner_screen").classList.add("hidden")):(l=new r(a,d),document.getElementById("start_game_screen").classList.add("hidden"),m()))}));let o=document.getElementById("unmuteButton"),c=document.getElementById("muteButton");function m(){l.update(),l.draw(),requestAnimationFrame(m)}o.classList.add("hidden"),c.addEventListener("click",(()=>{l.music.volume=0,l.audioElement.volume=0,o.classList.remove("hidden"),c.classList.add("hidden")})),o.addEventListener("click",(()=>{l.music.volume=.1,l.audioElement.volume=.1,c.classList.remove("hidden"),o.classList.add("hidden")}))}()}();
//# sourceMappingURL=main.js.map